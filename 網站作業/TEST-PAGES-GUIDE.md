# API 測試頁面驗證報告

## ✅ 文件檢查結果

### api-test.html
- **狀態**: ✅ 完全正常
- **行數**: 209 行
- **錯誤**: 無

**功能:**
- 🧪 API 健康檢查測試
- 💬 AI 聊天 API 測試
- 📊 模型選擇（支持多個 OpenRouter 模型）
- 🔍 環境資訊顯示
- ⏱️ 響應時間統計

### debug-test.html
- **狀態**: ✅ 完全正常
- **行數**: 310 行
- **錯誤**: 無

**功能:**
- 🔧 完整系統診斷工具
- 🔌 連接測試（Health Check）
- 📋 環境檢查
- 📊 詳細日誌輸出
- ⏱️ 性能監控

---

## 🚀 如何使用這些測試頁面

### 前置條件
確保後端已啟動：
```bash
cd 網站作業/backend
node server.js
# 應該看到: 🚀 Backend API listening on http://localhost:3000
```

---

### 方式 1: 使用 API 測試頁面

**打開方式:**
```bash
# 在瀏覽器中打開:
http://localhost:3000/api-test.html
```

**主要功能:**

1. **健康檢查測試**
   - 點擊「測試健康檢查」
   - 驗證後端是否運行
   - 預期回應: `{ "status": "ok", ... }`

2. **AI 聊天測試**
   - 選擇 AI 模型
   - 輸入測試訊息
   - 點擊「發送聊天請求」
   - 查看 AI 回應和完整的 API 回應結構

3. **環境資訊**
   - 顯示當前 URL
   - API 端點地址
   - 當前時間

**測試流程:**
```
1. 打開頁面
2. 先測試健康檢查
3. 如果成功，再測試聊天功能
4. 觀察回應時間和狀態碼
5. 檢查 JSON 回應是否正確
```

---

### 方式 2: 使用診斷工具

**打開方式:**
```bash
# 在瀏覽器中打開:
http://localhost:3000/debug-test.html
```

**主要功能:**

1. **環境檢查**
   - 顯示當前 URL
   - API 基礎地址
   - 瀏覽器資訊
   - 時間戳

2. **連接測試**
   - 「測試 /api/health」: 檢查後端服務
   - 「測試 /api/chat 端點」: 檢查 API 結構
   - 「完整聊天測試」: 端到端測試

3. **詳細日誌**
   - 實時顯示所有操作日誌
   - 顯示 HTTP 狀態碼
   - 顯示回應時間
   - 顯示 JSON 解析結果
   - 自動滾動到最新日誌

**測試流程:**
```
1. 打開頁面
2. 查看環境資訊
3. 點擊「執行完整診斷」
4. 按步驟檢查診斷結果:
   - ✅ 後端服務
   - ✅ API 端點
   - ✅ 聊天功能
5. 查看詳細日誌了解任何問題
```

---

## 📊 測試場景

### 場景 1: 後端正常運行
```
輸入: 健康檢查
預期: 
  ✅ HTTP 200
  ✅ { "status": "ok", ... }
```

### 場景 2: AI 聊天測試
```
輸入: "你好"
預期:
  ✅ HTTP 200
  ✅ { "ok": true, "response": { "choices": [...] } }
  ✅ 顯示 AI 回應
  ✅ 耗時時間
```

### 場景 3: 後端未運行
```
點擊測試按鈕
預期:
  ❌ 連接錯誤 (Failed to fetch)
  ❌ 診斷工具顯示紅色错误
  ✅ 提示需要啟動後端
```

### 場景 4: API Key 無效
```
後端運行但 API Key 錯誤
預期:
  ❌ HTTP 401 或 500
  ❌ 錯誤訊息: "API 金鑰認證失敗"
  ✅ 診斷工具顯示黃色警告
```

---

## 🔍 詳細日誌解讀

### api-test.html 日誌示例

**成功回應:**
```
[14:30:45] [200 OK]
耗時: 1234ms

AI 回應:
你好！很高興為您服務...

完整回應:
{
  "ok": true,
  "response": {
    "choices": [...]
  }
}
```

**錯誤回應:**
```
[200 OK]
{
  "ok": false,
  "error": "API 金鑰認證失敗",
  "status": "server_error"
}
```

---

### debug-test.html 日誌示例

**完整診斷 (成功):**
```
========== 開始完整診斷 ==========
[14:30:45] API Base: http://localhost:3000
[14:30:45] 1️⃣ 檢查後端服務...
[14:30:46] ✅ 後端服務正常運行
[14:30:46] 2️⃣ 檢查環境變數...
[14:30:46] ⚠️ 無法在前端檢查...
[14:30:46] 3️⃣ 測試 API 端點...
[14:30:46] 發送 payload: {...}
[14:30:46] HTTP 狀態: 200
[14:30:46] ✅ JSON 解析成功
[14:30:47] ✅ AI 回應: 你好！...
========== 診斷完成 ==========
```

**完整診斷 (失敗):**
```
========== 開始完整診斷 ==========
[14:30:45] API Base: http://localhost:3000
[14:30:45] 1️⃣ 檢查後端服務...
[14:30:46] ❌ 無法連接到後端 (Failed to fetch)
[14:31:46] ⚠️ 請確保後端已啟動
========== 診斷完成 ==========
```

---

## 🎯 常見測試場景

### ✅ 一切正常
```bash
# 後端運行
node backend/server.js

# 打開診斷工具
http://localhost:3000/debug-test.html

# 點擊「執行完整診斷」
# 應該看到:
# ✅ 後端服務正常運行
# ✅ JSON 解析成功
# ✅ AI 回應成功
```

### ❌ 後端未啟動
```bash
# 不運行後端

# 打開診斷工具
http://localhost:3000/debug-test.html

# 點擊「執行完整診斷」
# 應該看到:
# ❌ 無法連接到後端 (Failed to fetch)
```

### ⚠️ API Key 無效
```bash
# 修改 .env 中的 API Key 為無效值

# 後端運行
node backend/server.js

# 打開診斷工具
http://localhost:3000/debug-test.html

# 點擊「完整聊天測試」
# 應該看到:
# ❌ 伺服器錯誤: API 金鑰認證失敗 (401)
```

---

## 📋 故障排除

### 問題 1: "無法連接到伺服器"
```
原因: 後端未運行或 3000 端口被占用
解決: 
  1. 確保運行: cd 網站作業/backend && node server.js
  2. 檢查端口: lsof -i :3000
  3. 更改端口: 修改 .env 中的 PORT
```

### 問題 2: "JSON 解析失敗"
```
原因: 後端返回非 JSON 回應（如 HTML 錯誤頁面）
解決:
  1. 檢查後端日誌
  2. 確保路由正確配置
  3. 查看是否有 500 錯誤
```

### 問題 3: "API Key 認證失敗"
```
原因: OPENROUTER_API_KEY 無效或過期
解決:
  1. 檢查 .env 文件中的 API Key
  2. 確認 Key 格式: sk-or-v1-xxx...
  3. 從 OpenRouter 獲取新 Key
  4. 重啟後端服務
```

### 問題 4: "超時"
```
原因: OpenRouter API 響應慢或網路問題
解決:
  1. 等待後重試
  2. 檢查網路連接
  3. 嘗試簡短的問題
  4. 檢查 API 配額
```

---

## 🌐 線上測試 (Vercel 部署)

部署到 Vercel 後，可以在線上訪問測試頁面：

```bash
# API 測試頁面
https://web-dreamcoreshop.vercel.app/api-test.html

# 診斷工具
https://web-dreamcoreshop.vercel.app/debug-test.html
```

**注意:** 線上測試需要：
1. ✅ Vercel 環境變數已正確配置
2. ✅ 後端 API 已部署並運行
3. ✅ API Key 有效且配額充足

---

## 📊 性能基準

典型的響應時間：

| 操作 | 本地 | 線上 |
|------|------|------|
| Health Check | 1-5ms | 50-200ms |
| 簡短聊天 | 1000-3000ms | 2000-5000ms |
| 長聊天 | 3000-10000ms | 5000-15000ms |

---

## ✅ 測試清單

使用以下清單驗證系統：

- [ ] API 測試頁面可以打開
- [ ] 健康檢查返回 HTTP 200
- [ ] 聊天 API 返回有效 JSON
- [ ] AI 能正確回應
- [ ] 診斷工具可以打開
- [ ] 完整診斷通過
- [ ] 響應時間在正常範圍
- [ ] 沒有 Console 錯誤
- [ ] 線上 (Vercel) 也正常運行

---

## 📞 需要幫助？

1. 檢查 [QUICK_START.md](QUICK_START.md) 快速開始指南
2. 查看 [TROUBLESHOOTING.md](TROUBLESHOOTING.md) 故障排除指南
3. 查看後端日誌: `node backend/server.js` 的輸出
4. 查看瀏覽器 Console: F12 → Console 標籤
5. 使用診斷工具運行完整診斷

---

**所有測試頁面都已驗證正常！✅**
