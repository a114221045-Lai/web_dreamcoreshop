<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API æ¸¬è©¦é é¢ - å¤¢æ ¸ç‰©å“è²©è³£éƒ¨</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1F2A44 0%, #0e1322 100%);
      color: #e6e6eb;
      padding: 20px;
      min-height: 100vh;
    }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { margin-bottom: 20px; color: #F2E2A2; }
    .test-section {
      background: rgba(255,255,255,0.05);
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      border: 1px solid rgba(123,114,137,0.2);
    }
    h2 { color: #F2E2A2; margin-bottom: 15px; font-size: 1.2rem; }
    .input-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; color: #7B7289; }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(123,114,137,0.3);
      color: #e6e6eb;
      border-radius: 4px;
      font-size: 14px;
    }
    textarea { min-height: 80px; font-family: monospace; }
    button {
      background: #F2E2A2;
      color: #1F2A44;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }
    button:hover { background: #ffedb3; transform: translateY(-2px); }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .response {
      background: rgba(0,0,0,0.3);
      padding: 15px;
      border-radius: 6px;
      margin-top: 15px;
      border-left: 3px solid #7B7289;
    }
    .response pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: #a8dadc;
    }
    .status { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; margin-left: 10px; }
    .status.success { background: #28a745; color: white; }
    .status.error { background: #dc3545; color: white; }
    .status.pending { background: #ffc107; color: #000; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª API æ¸¬è©¦é é¢</h1>
    <p style="margin-bottom: 30px; color: #7B7289;">ç”¨æ–¼æ¸¬è©¦å¾Œç«¯ API çš„å‘¼å«èˆ‡å›æ‡‰</p>

    <!-- Health Check æ¸¬è©¦ -->
    <div class="test-section">
      <h2>/api/health - å¥åº·æª¢æŸ¥</h2>
      <button id="health-btn">æ¸¬è©¦å¥åº·æª¢æŸ¥</button>
      <div id="health-response" class="response" style="display:none;">
        <strong>å›æ‡‰ï¼š</strong>
        <pre id="health-data"></pre>
      </div>
    </div>

    <!-- Chat API æ¸¬è©¦ -->
    <div class="test-section">
      <h2>/api/chat - AI èŠå¤©æ¸¬è©¦</h2>
      
      <div class="input-group">
        <label for="model-select">æ¨¡å‹é¸æ“‡ï¼š</label>
        <select id="model-select">
          <option value="google/gemma-3-27b-it:free">google/gemma-3-27b-it:freeï¼ˆé è¨­ï¼‰</option>
          <option value="google/gemini-flash-1.5">google/gemini-flash-1.5</option>
          <option value="meta-llama/llama-3-8b-instruct:free">meta-llama/llama-3-8b-instruct:free</option>
        </select>
      </div>

      <div class="input-group">
        <label for="user-message">ä½¿ç”¨è€…è¨Šæ¯ï¼š</label>
        <textarea id="user-message" placeholder="è«‹è¼¸å…¥æ¸¬è©¦è¨Šæ¯...">è«‹ç”¨ç°¡çŸ­çš„ä¸­æ–‡ä»‹ç´¹å¤¢æ ¸é¢¨æ ¼</textarea>
      </div>

      <button id="chat-btn">ç™¼é€èŠå¤©è«‹æ±‚</button>
      <div id="chat-response" class="response" style="display:none;">
        <strong>å›æ‡‰ï¼š</strong>
        <pre id="chat-data"></pre>
      </div>
    </div>

    <!-- ç’°å¢ƒè³‡è¨Š -->
    <div class="test-section">
      <h2>ğŸ“‹ ç’°å¢ƒè³‡è¨Š</h2>
      <div style="font-family: monospace; font-size: 13px; color: #7B7289;">
        <div>ç•¶å‰ URLï¼š<span id="current-url"></span></div>
        <div>API ç«¯é»ï¼š<span id="api-endpoint"></span></div>
        <div>æ™‚é–“ï¼š<span id="current-time"></span></div>
      </div>
    </div>
  </div>

  <script>
    // ç’°å¢ƒè³‡è¨Šé¡¯ç¤º
    document.getElementById('current-url').textContent = window.location.href
    const apiBase = window.location.hostname === 'localhost' 
      ? 'http://localhost:3000'
      : window.location.origin
    document.getElementById('api-endpoint').textContent = apiBase
    document.getElementById('current-time').textContent = new Date().toLocaleString('zh-TW')

    // Health Check æ¸¬è©¦
    document.getElementById('health-btn').addEventListener('click', async () => {
      const btn = document.getElementById('health-btn')
      const responseDiv = document.getElementById('health-response')
      const dataEl = document.getElementById('health-data')

      btn.disabled = true
      btn.textContent = 'æ¸¬è©¦ä¸­...'
      responseDiv.style.display = 'block'
      dataEl.textContent = 'è«‹æ±‚ä¸­...'

      try {
        const response = await fetch(`${apiBase}/api/health`)
        const data = await response.json()
        
        const status = response.ok ? 'success' : 'error'
        dataEl.innerHTML = `<span class="status ${status}">${response.status} ${response.statusText}</span>\n\n${JSON.stringify(data, null, 2)}`
      } catch (err) {
        dataEl.innerHTML = `<span class="status error">éŒ¯èª¤</span>\n\n${err.message}`
      } finally {
        btn.disabled = false
        btn.textContent = 'æ¸¬è©¦å¥åº·æª¢æŸ¥'
      }
    })

    // Chat API æ¸¬è©¦
    document.getElementById('chat-btn').addEventListener('click', async () => {
      const btn = document.getElementById('chat-btn')
      const responseDiv = document.getElementById('chat-response')
      const dataEl = document.getElementById('chat-data')
      const model = document.getElementById('model-select').value
      const userMessage = document.getElementById('user-message').value.trim()

      if (!userMessage) {
        alert('è«‹è¼¸å…¥æ¸¬è©¦è¨Šæ¯')
        return
      }

      btn.disabled = true
      btn.textContent = 'ç™¼é€ä¸­...'
      responseDiv.style.display = 'block'
      dataEl.textContent = 'è«‹æ±‚ä¸­...'

      try {
        const startTime = Date.now()
        const response = await fetch(`${apiBase}/api/chat`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            messages: [{ role: 'user', content: userMessage }],
            model: model
          })
        })
        const endTime = Date.now()
        const data = await response.json()
        
        const status = response.ok && data.ok ? 'success' : 'error'
        const elapsed = endTime - startTime

        let output = `<span class="status ${status}">${response.status} ${response.statusText}</span>\nè€—æ™‚ï¼š${elapsed}ms\n\n`
        
        if (data.ok) {
          let aiResponse = 'ç„¡æ³•è§£æå›æ‡‰'
          
          // å˜—è©¦å¤šç¨®å›æ‡‰æ ¼å¼
          if (data.response?.choices?.[0]?.message?.content) {
            aiResponse = data.response.choices[0].message.content
          } else if (data.response?.content) {
            aiResponse = data.response.content
          } else if (typeof data.response === 'string') {
            aiResponse = data.response
          } else if (data.response?.text) {
            aiResponse = data.response.text
          }
          
          output += `âœ… AI å›æ‡‰ï¼š\n${aiResponse}\n\n`
          output += `ğŸ“‹ å®Œæ•´å›æ‡‰çµæ§‹ï¼š\n${JSON.stringify(data, null, 2)}`
        } else {
          output += `âŒ éŒ¯èª¤ï¼š${data.error || 'æœªçŸ¥éŒ¯èª¤'}\n\n`
          output += `å®Œæ•´å›æ‡‰ï¼š\n${JSON.stringify(data, null, 2)}`
        }
        
        dataEl.textContent = output
      } catch (err) {
        dataEl.textContent = `âŒ ç•°å¸¸éŒ¯èª¤\n\n${err.message}\n\n${err.stack || 'ç„¡å †ç–Šä¿¡æ¯'}`
      } finally {
        btn.disabled = false
        btn.textContent = 'ç™¼é€èŠå¤©è«‹æ±‚'
      }
    })
  </script>
</body>
</html>
